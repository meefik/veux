!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).neux={})}(this,(function(t){"use strict";function e(t){return void 0===t}function n(t){return"function"==typeof t}function o(t){return"string"==typeof t}function s(t){return Array.isArray(t)}function c(t){return"object"==typeof t&&null!==t&&(t.constructor===Object||t.constructor===Array)}function i(t){return t instanceof Date}function r(t){if(!c(t))return t;const e=s(t)?[]:{};for(const n in t)e[n]=r(t[n]);return e}const a=Symbol("context"),l={};function f(t){return c(t)?t:l}function u(t,e,n,o){const s=t[a];if(s){const t=s.get(e)||{};t[n]=o||null,s.set(e,t)}}function d(t,e,n){if(t[a])throw Error("Collision in signal binding");const o=new Map;t[a]=o;const s=e();delete t[a];for(const t of o){const[e,o]=t;for(const t in o)n(e,t,o[t])}return s}class p{constructor(t){this._list={},this._context=t}on(t,e){if(t&&e){const n=this._list,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!1)}}once(t,e){if(t&&e){const n=this._list,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!0)}}off(t,e){if(t){const n=this._list,o=[].concat(t);for(const t of o)n[t]&&(e?(n[t].delete(e),n[t].size||delete n[t]):(n[t].clear(),delete n[t]))}else this._list={}}emit(t,...e){const n=this._list;if("*"===t)for(const t in n)for(const[o,s]of n[t]){try{o.apply(this._context,e)}catch(t){console.error(t)}s&&this.off(t,o)}else{const o=new Set([].concat(t));for(const t of o)if(n[t])for(const[o,s]of n[t]){try{o.apply(this._context,e)}catch(t){console.error(t)}s&&this.off(t,o)}}}}const h=Symbol("signal"),m=/^\$([^$]|$)/u;function w(t,o,s,c,i){i.emit(s),c=c.bind(t,o,s);return d(t,c,((r,a,l)=>{const f=(l=n(l)?l.bind(t):null)?(t,n,c,i)=>{const r=o[s],a=parseInt(c,10);if(e(t))r.splice(a,1);else if(e(n)){const e=l(t,a,i);r[a]=e}else{const e=l(t,a,i);r.splice(a,1,e)}}:()=>{o[s]=c()};r.$$on(a,f),i.once(s,(()=>r.$$off(a,f)))}))}function y(t,e,n,o){if(o.emit(e),n[h]){const s=(n,o,s,c,i=[])=>{t.$$emit([e,"*"],n,o,s,c,[...i,e])};n.$$on("*",s),o.once(e,(()=>n.$$off("*",s)))}}function b(t,o,s){const c=f(this);t=t.bind(c),o=o?o.bind(c):()=>{},s=s?s.bind(c):()=>{};const i=[],r=d(c,t,((s,r,a)=>{const l=(a=n(a)?a.bind(c):null)?(t,n,s,c)=>{const i=+s;if(e(t))o(void 0,i,"del");else if(e(n)){const e=a(t,i,c);o(e,i,"add")}else{const e=a(t,i,c);o(e,i,"upd")}}:(...e)=>{o(t(...e))};s.$$on(r,l),i.push((()=>s.$$off(r,l)))}));return o(r),()=>{for(const t of i)t();s()}}function g(t){if(!c(t))return t;const{Element:s}=window,i=f(this),{tagName:r="div",tag:a,namespaceURI:l,classList:u,attributes:d,style:p,dataset:h,on:m,children:w,ref:y,...$}=t,v=[],E=(t,e)=>{if(n(t)){const n=b.call(i,t,e);v.push(n)}else e(t)},N=function(t,e){const{Element:n}=window,s=[];let c,i,r;if(o(t))if(/[^a-zA-Z0-9-_.#]/u.test(t)){const e=document.createElement("div");e.innerHTML=t,e.firstChild instanceof n&&(c=e.firstChild,i=c.tagName)}else{const e=t.match(/([.#]?[^\s#.]+)/gu)||[];for(const t of e){const e=t[0];"."===e?s.push(t.slice(1)):"#"===e?r=t.slice(1):i=t}}else t instanceof n&&(c=t,i=c.tagName);if(!c){if("http://www.w3.org/1999/xhtml"===e&&(e=null),!e)switch(`${i}`.toLowerCase()){case"svg":e="http://www.w3.org/2000/svg";break;case"math":e="http://www.w3.org/1998/Math/MathML"}c=e?document.createElementNS(e,i):document.createElement(i)}return r&&(c.id=r),s.length&&(c.className=s.join(" ")),c}(a??r,l);if(!e(m))for(const t in m){const e=m[t];n(e)&&N.addEventListener(t,(t=>e.call(i,t)))}const x=({children:t},e)=>{for(const n of t){const t=new CustomEvent(e,{cancelable:!0});n.dispatchEvent(t)}};N.addEventListener("mounted",(t=>{t.defaultPrevented||x(N,"mounted")})),N.addEventListener("removed",(t=>{if(!t.defaultPrevented){x(N,"removed");for(const t of v)t()}})),e(u)||E(u,(t=>{Array.isArray(t)?N.classList=t.join(" "):o(t)&&(N.classList=t)})),e(d)||E(d,(t=>{for(const n in t)E(t[n],(t=>{e(t)?N.removeAttribute(n):N.setAttribute(n,t)}))})),e(p)||E(p,(t=>{for(const n in t)E(t[n],(t=>{/[A-Z]/u.test(n)?e(t)?delete N.style[n]:N.style[n]=t:e(t)?N.style.removeProperty(n):N.style.setProperty(n,t)}))})),e(h)||E(h,(t=>{for(const n in t)E(t[n],(t=>{e(t)?delete N.dataset[n]:N.dataset[n]=t}))}));for(const t in $)E($[t],(n=>{e(n)?delete N[t]:N[t]=n}));return e(w)||E(w,((t,e,n)=>{if("del"===n){const t=N.children[e];t&&N.removeChild(t)}else if("add"===n){const e=c(t)?{namespaceURI:N.namespaceURI,...t}:t,n=g.call(i,e);n&&N.appendChild(n)}else if("upd"===n){const n=N.children[e];if(n){const e=c(t)?{namespaceURI:N.namespaceURI,...t}:t,o=g.call(i,e);o&&N.replaceChild(o,n)}}else if(N.innerHTML="",c(t)){const e=[].concat(t);for(const t of e){const e=c(t)?{namespaceURI:N.namespaceURI,...t}:t,n=g.call(i,e);n instanceof s&&N.appendChild(n)}}else{const e=document.createTextNode(t);N.appendChild(e)}})),n(y)&&y.call(i,N),N}t.effect=b,t.h=function(t,e,n){return c(e)&&!s(e)||(n=e,e={}),g.call(this,{tag:t,children:n,...e})},t.l10n=function(t,e){const{language:n=navigator.language,fallback:r="en"}=e||{};return(e,a,l=n)=>{o(a)&&(l=a,a=null),l&&t[l]||(l=r);let f=`${e}`.split(".").reduce(((t,e)=>c(t)?t[e]:""),t[l]);for(const t in a){const e=new RegExp(`%\\{${t}\\}`,"gu");let n=a[t];if(s(n)){const[t,e]=n;c(e)&&("number"==typeof t||i(t))&&(n=t.toLocaleString(l,e))}f=f.replace(e,n)}return f}},t.mount=function(t,e){const{MutationObserver:n,CustomEvent:o,Element:s}=window,{ELEMENT_NODE:c}=s,i=(t,e)=>{if(t.nodeType!==c)return;const n=new o(e,{cancelable:!0});t.dispatchEvent(n)},r=new n((e=>{for(const n of e)if("childList"===n.type)n.addedNodes.forEach((t=>{i(t,"mounted")})),n.removedNodes.forEach((e=>{i(e,"removed"),e===t&&r.disconnect()}));else if("attributes"===n.type){const t=n.target,{attributeName:e}=n,{oldValue:s}=n,c=t.getAttribute(e);if(s!==c){const n=new o("changed",{detail:{attributeName:e,oldValue:s,newValue:c}});t.dispatchEvent(n)}}}));r.observe(e,{childList:!0,subtree:!0,attributeOldValue:!0}),e.appendChild(t)},t.render=g,t.rpc=function(t,e={}){const{method:n="POST",headers:o={}}=e,s={};return Object.seal(s),new Proxy(s,{get:(s,i)=>async function(s){const r={};if(s instanceof FormData);else if(s instanceof File||s instanceof Blob){const t=new FormData;t.append("file",s),s=t}else c(s)?(r["Content-Type"]="application/json",s=JSON.stringify(s)):s=`${s}`;const a=await fetch(`${t}/${i}`,{...e,method:n,headers:Object.defineProperties(r,{...Object.getOwnPropertyDescriptors(o)}),body:s});if(!a.ok)throw Error(a.statusText);const l=a.headers.get("content-type")||"";return/^application\/json/u.test(l)?await a.json():/^application\/octet-stream/u.test(l)?await a.blob():await a.text()}})},t.signal=function t(e={}){if(!c(e)||e[h])return e;const i=f(this),a=new p(i),l=new p,d=new p,b={$:t=>g["$"+t],$$on:(...t)=>a.on(...t),$$once:(...t)=>a.once(...t),$$off:(...t)=>a.off(...t),$$emit:(...t)=>a.emit(...t),$$each(t,e=i){if(s(g))return n(t)&&u(i,g,"#",t.bind(e)),g.map(t,e).filter(Boolean)}},g=new Proxy(e,{get:(t,e)=>e===h||(e in b?b[e]:(o(e)&&m.test(e)&&(n(t[e=e.slice(1)])||u(i,g,e)),Reflect.get(t,e))),set:(e,f,u)=>{if(o(f)&&m.test(f)){const t=f.slice(1)||"*";return n(u)&&a.on(t,u),!0}const p=r(e[f]);if(n(u)){u=w(i,g,f,u,d)}c(u)&&(u=t.call(i,u),y(g,f,u,l));const h=e[f]!==u||"length"===f&&s(e);if(!Reflect.set(e,f,u))return!1;if(h){const t=[f];s(e)&&isNaN(f)||t.push("*"),s(e)&&!isNaN(f)&&t.push("#"),a.emit(t,u,p,f,g)}return!0},deleteProperty:(t,e)=>{if(o(e)&&m.test(e)){const t=e.slice(1)||"*";return a.off(t),!0}const n=r(t[e]);if(!Reflect.deleteProperty(t,e))return!1;l.emit(e),d.emit(e);const c=[e];return s(t)&&isNaN(e)||c.push("*"),s(t)&&!isNaN(e)&&c.push("#"),a.emit(c,void 0,n,e,g),!0}});for(const s in e){if(n(e[s])){const t=e[s];if(o(s)&&m.test(s)){const n=s.slice(1)||"*";a.on(n,t),delete e[s]}else e[s]=w(i,g,s,t,d)}if(c(e[s])){const n=t.call(i,e[s]);e[s]=n,y(g,s,n,l)}}return g}}));
